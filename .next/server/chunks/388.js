exports.id=388,exports.ids=[388],exports.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},55378:(e,t,o)=>{"use strict";o.d(t,{R:()=>r});var s=o(41405);class a extends s.ZP{constructor(){super("OmniPrimeGenesis"),this.version(1).stores({profiles:"id, timestamp"})}}let n=new a;class i{constructor(){this.cache=null,this.CACHE_KEY="omni_prime_genesis_profile",this.CACHE_TTL=864e5,this.initialize().catch(console.error)}async initialize(){try{let e=await n.profiles.get(this.CACHE_KEY);e&&Date.now()-e.timestamp<this.CACHE_TTL&&(this.cache=e)}catch(e){console.error("Failed to initialize ContextInjector:",e)}}async cacheProfile(e){let t={id:this.CACHE_KEY,data:e,timestamp:Date.now()};this.cache=t;try{await n.profiles.put(t)}catch(e){console.error("Failed to cache genesis profile:",e)}}getProfile(){return this.cache?.data??null}hasProfile(){return null!==this.cache}async clearProfile(){this.cache=null;try{await n.profiles.delete(this.CACHE_KEY)}catch(e){console.error("Failed to clear genesis profile:",e)}}getGenesisContext(e={}){if(!this.cache?.data)return"";let t=this.cache.data;switch(e.format??"detailed"){case"minimal":return this.formatMinimalContext(t,e);case"compact":return this.formatCompactContext(t,e);default:return this.formatDetailedContext(t,e)}}getContextComponents(){if(!this.cache?.data)return{formattedContext:"",expertiseGuidance:"",toneGuidance:"",workStyleGuidance:""};let e=this.cache.data;return{formattedContext:this.getGenesisContext(),expertiseGuidance:this.getExpertiseGuidance(e.skillLevel),toneGuidance:this.getToneGuidance(e.contentTone),workStyleGuidance:this.getWorkStyleGuidance(e.workStyle)}}buildSystemPrompt(e,t={}){let o=this.getGenesisContext(t);return o?"start"===(t.position??"end")?`${o}

${e}`:`${e}

${o}`:e}formatDetailedContext(e,t){let o=[t.contextPrefix??"[OMNI-PRIME USER CONTEXT]","─".repeat(40),"","Identity Profile:",`• Role: ${this.formatUseCase(e.useCase)}`,`• Expertise: ${e.skillLevel}`,`• Work Style: ${e.workStyle}`,`• Communication: ${e.contentTone}`,""];if(e.objectives.length>0){for(let t of(o.push("Primary Objectives:"),e.objectives))o.push(`• ${t}`);o.push("")}if(!1!==t.includeTools&&e.toolPreferences.length>0){for(let t of(o.push("Preferred Tools:"),e.toolPreferences))o.push(`• ${t}`);o.push("")}return!1!==t.includeExpertise&&(o.push(this.getExpertiseGuidance(e.skillLevel)),o.push("")),!1!==t.includeTone&&(o.push(this.getToneGuidance(e.contentTone)),o.push("")),!1!==t.includeWorkStyle&&(o.push(this.getWorkStyleGuidance(e.workStyle)),o.push("")),o.push("─".repeat(40)),o.push(t.contextSuffix??"[END CONTEXT]"),o.join("\n")}formatCompactContext(e,t){let o=["[Context]",`Role: ${this.formatUseCase(e.useCase)}`,`Level: ${e.skillLevel}`,`Style: ${e.contentTone}`];return e.objectives.length>0&&o.push(`Goals: ${e.objectives.join(", ")}`),!1!==t.includeExpertise&&o.push(this.getExpertiseGuidance(e.skillLevel)),!1!==t.includeTone&&o.push(this.getToneGuidance(e.contentTone)),o.join(" | ")}formatMinimalContext(e,t){return"[Personalized Context Active]"}getExpertiseGuidance(e){return({beginner:"GUIDANCE: Explain concepts thoroughly. Avoid jargon. Offer step-by-step instructions. Check for understanding.",intermediate:"GUIDANCE: Balance technical depth with accessibility. Assume familiarity with basic concepts. Focus on practical application.",expert:"GUIDANCE: Be concise and technical. Skip basic explanations. Focus on edge cases, optimization, and advanced patterns."})[e]}getToneGuidance(e){return({professional:"TONE: Formal, business-appropriate, clear and direct. Use industry-standard terminology.",casual:"TONE: Friendly, conversational, approachable. Feel free to use informal language and humor.",technical:"TONE: Precise, use domain terminology liberally. Structured, logical presentation of information.",creative:"TONE: Expressive, use analogies and metaphors. Engaging, inspiring, and imaginative."})[e]}getWorkStyleGuidance(e){return({solo:"WORK STYLE: Provide complete, self-contained solutions. The user works independently.",team:"WORK STYLE: Consider collaboration patterns. Suggest how outputs can be shared or reviewed by others.",hybrid:"WORK STYLE: Balance independent work with collaborative checkpoints. Offer both solo and team-oriented approaches."})[e]}formatUseCase(e){return({marketer:"Marketing Professional",developer:"Software Developer",founder:"Startup Founder",writer:"Content Writer",researcher:"Researcher",designer:"Designer",student:"Student",custom:"Custom User"})[e]??"User"}getCacheAge(){return this.cache?Date.now()-this.cache.timestamp:null}isCacheStale(){let e=this.getCacheAge();return null===e||e>this.CACHE_TTL}}let r=new i},68628:(e,t,o)=>{"use strict";o.d(t,{S:()=>l});var s=o(54214);let a=process.env.OLLAMA_URL||"http://host.docker.internal:11434",n=process.env.OPENAI_API_KEY||"",i=process.env.ANTHROPIC_API_KEY||"";class r{constructor(){this.openaiClient=null,n&&(this.openaiClient=new s.ZP({apiKey:n}))}detectProvider(e){return e.startsWith("ollama/")||e.startsWith("local/")?"ollama":e.startsWith("gpt-")||e.startsWith("openai/")?"openai":e.startsWith("claude-")||e.startsWith("anthropic/")?"anthropic":"ollama"}normalizeModel(e,t){for(let t of["ollama/","local/","openai/","anthropic/"])if(e.startsWith(t))return e.slice(t.length);return e}convertTools(e){return e.map(e=>({type:"function",function:{name:e.name,description:e.description||`Execute ${e.name}`,parameters:e.inputSchema}}))}async complete(e){let t=e.provider||this.detectProvider(e.model),o=this.normalizeModel(e.model,t);switch(t){case"ollama":return this.completeOllama({...e,model:o});case"openai":return this.completeOpenAI({...e,model:o});case"anthropic":return this.completeAnthropic({...e,model:o});default:throw Error(`Unsupported provider: ${t}`)}}async *streamCompletion(e){let t=e.provider||this.detectProvider(e.model),o=this.normalizeModel(e.model,t);switch(t){case"ollama":yield*this.streamOllama({...e,model:o});break;case"openai":yield*this.streamOpenAI({...e,model:o});break;case"anthropic":yield*this.streamAnthropic({...e,model:o});break;default:yield{type:"error",error:{code:"UNSUPPORTED_PROVIDER",message:`Provider ${t} is not supported`}}}}async completeOllama(e){let t=await fetch(`${a}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:e.messages,stream:!1,options:{temperature:e.temperature??.7,num_predict:e.maxTokens,top_p:e.topP,stop:e.stop},tools:e.tools?.map(e=>({type:"function",function:e.function}))}),signal:e.signal});if(!t.ok){let e=await t.text();throw Error(`Ollama error: ${e}`)}let o=await t.json();return{content:o.message.content,toolCalls:o.message.tool_calls?.map((e,t)=>({id:`call_${t}`,name:e.function.name,arguments:e.function.arguments})),usage:{promptTokens:o.prompt_eval_count??0,completionTokens:o.eval_count??0,totalTokens:(o.prompt_eval_count??0)+(o.eval_count??0)},model:e.model,provider:"ollama",finishReason:o.done?"stop":"length"}}async *streamOllama(e){let t=await fetch(`${a}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:e.messages,stream:!0,options:{temperature:e.temperature??.7,num_predict:e.maxTokens,top_p:e.topP,stop:e.stop},tools:e.tools?.map(e=>({type:"function",function:e.function}))}),signal:e.signal});if(!t.ok){let e=await t.text();yield{type:"error",error:{code:"OLLAMA_ERROR",message:e}};return}let o=t.body?.getReader();if(!o){yield{type:"error",error:{code:"STREAM_ERROR",message:"Failed to get response reader"}};return}let s=new TextDecoder,n="";try{for(;;){let{done:e,value:t}=await o.read();if(e)break;let a=(n+=s.decode(t,{stream:!0})).split("\n");for(let e of(n=a.pop()||"",a))if(e.trim())try{let t=JSON.parse(e);if(t.message?.content&&(yield{type:"content",content:t.message.content}),t.message?.tool_calls)for(let e of t.message.tool_calls)yield{type:"tool_call",toolCall:{id:`call_${Date.now()}`,name:e.function.name,arguments:JSON.stringify(e.function.arguments),isComplete:!0}};t.done&&(yield{type:"usage",usage:{promptTokens:t.prompt_eval_count,completionTokens:t.eval_count,totalTokens:(t.prompt_eval_count??0)+(t.eval_count??0)}},yield{type:"done",finishReason:"stop"})}catch{}}}finally{o.releaseLock()}}async completeOpenAI(e){if(!this.openaiClient)throw Error("OpenAI client not initialized - API key missing");let t=await this.openaiClient.chat.completions.create({model:e.model,messages:e.messages,tools:e.tools,tool_choice:e.toolChoice,temperature:e.temperature,max_tokens:e.maxTokens,top_p:e.topP,stop:e.stop}),o=t.choices[0];if(!o)throw Error("No response from OpenAI");return{content:o.message.content||"",toolCalls:o.message.tool_calls?.map(e=>({id:e.id,name:e.function.name,arguments:JSON.parse(e.function.arguments)})),usage:{promptTokens:t.usage?.prompt_tokens??0,completionTokens:t.usage?.completion_tokens??0,totalTokens:t.usage?.total_tokens??0},model:t.model,provider:"openai",finishReason:o.finish_reason}}async *streamOpenAI(e){if(!this.openaiClient){yield{type:"error",error:{code:"OPENAI_NOT_INITIALIZED",message:"OpenAI client not initialized - API key missing"}};return}let t=await this.openaiClient.chat.completions.create({model:e.model,messages:e.messages,tools:e.tools,tool_choice:e.toolChoice,temperature:e.temperature,max_tokens:e.maxTokens,top_p:e.topP,stop:e.stop,stream:!0}),o={};for await(let e of t){let t=e.choices[0]?.delta;if(t){if(t.content&&(yield{type:"content",content:t.content}),t.tool_calls)for(let e of t.tool_calls){let t=e.id||`call_${Date.now()}`;o[t]||(o[t]={name:"",arguments:""}),e.function?.name&&(o[t].name+=e.function.name),e.function?.arguments&&(o[t].arguments+=e.function.arguments);let s=o[t].name&&o[t].arguments&&e.function?.arguments?.includes("}");yield{type:"tool_call",toolCall:{id:t,name:o[t].name,arguments:o[t].arguments,argumentsDelta:e.function?.arguments,isComplete:!!s}}}e.choices[0]?.finish_reason&&(yield{type:"done",finishReason:e.choices[0].finish_reason}),e.usage&&(yield{type:"usage",usage:{promptTokens:e.usage.prompt_tokens,completionTokens:e.usage.completion_tokens,totalTokens:e.usage.total_tokens}})}}}async completeAnthropic(e){if(!i)throw Error("Anthropic API key not configured");let t=e.messages.find(e=>"system"===e.role),o=e.messages.filter(e=>"system"!==e.role),s=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:e.model,max_tokens:e.maxTokens??4096,system:t?.content,messages:o.map(e=>({role:"tool"===e.role?"user":e.role,content:e.content})),temperature:e.temperature,top_p:e.topP,stop_sequences:e.stop,tools:e.tools?.map(e=>({name:e.function.name,description:e.function.description,input_schema:e.function.parameters}))}),signal:e.signal});if(!s.ok){let e=await s.text();throw Error(`Anthropic error: ${e}`)}let a=await s.json();return{content:a.content.find(e=>"text"===e.type)?.text||"",toolCalls:a.content.filter(e=>"tool_use"===e.type).map(e=>({id:`call_${Date.now()}`,name:e.name||"",arguments:e.input})),usage:{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.input_tokens+a.usage.output_tokens},model:a.model,provider:"anthropic",finishReason:"tool_use"===a.stop_reason?"tool_calls":a.stop_reason}}async *streamAnthropic(e){if(!i){yield{type:"error",error:{code:"ANTHROPIC_NOT_INITIALIZED",message:"Anthropic API key not configured"}};return}yield{type:"error",error:{code:"NOT_IMPLEMENTED",message:"Anthropic streaming not yet implemented"}}}isProviderAvailable(e){switch(e){case"ollama":return!0;case"openai":return!!this.openaiClient;case"anthropic":return!!i;default:return!1}}async listModels(e){switch(e){case"ollama":try{let e=await fetch(`${a}/api/tags`);return(await e.json()).models.map(e=>e.name)}catch{return[]}case"openai":if(!this.openaiClient)return[];try{return(await this.openaiClient.models.list()).data.filter(e=>e.id.startsWith("gpt-")).map(e=>e.id)}catch{return[]}case"anthropic":return["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];default:return[]}}}let l=new r},45019:(e,t,o)=>{"use strict";o.d(t,{U:()=>p});var s=o(5499),a=o(48645),n=o(57745),i=o(31626);let r={read_file:"filesystem",write_file:"filesystem",list_directory:"filesystem",search_files:"filesystem",filesystem:"filesystem",fetch:"web",web_search:"web",brave_search:"web",http_request:"web",query:"database",execute_sql:"database",sqlite:"database",database:"database",api_call:"api",rest_api:"api",graphql:"api",send_message:"communication",email:"communication",slack:"communication",run_command:"development",execute_code:"development",github:"development",git:"development",npm:"development",parse_csv:"data",parse_json:"data",analyze_data:"data",chart:"data"},l=e=>{if(!e)return null;let t=e.server?{...e.server,args:e.server.args??[],description:e.server.description??"",url:e.server.url??"",config:e.server.config??{},isSecure:!!e.server.isSecure,acceptsFile:!!e.server.acceptsFile}:void 0;return{...e,description:e.description??"",inputSchema:e.inputSchema??{},lastUsedAt:e.lastUsedAt??null,server:t}};class c{async getTools(e={}){let t=(0,s.V)(),{searchQuery:o,category:r,serverId:c,isEnabled:p,limit:u=50,offset:d=0}=e,m=[];c&&m.push((0,n.eq)(a.mcpTools.serverId,c)),void 0!==p&&m.push((0,n.eq)(a.mcpTools.isEnabled,p)),o&&m.push((0,i.i6)`(${a.mcpTools.name} LIKE ${`%${o}%`} OR ${a.mcpTools.description} LIKE ${`%${o}%`})`);let h=t.query.mcpTools.findMany({where:m.length>0?(0,n.xD)(...m):void 0,with:{server:!0},limit:u,offset:d,orderBy:[(0,i.i6)`${a.mcpTools.useCount} DESC`]}),f=(await h).map(l).filter(e=>null!==e),g=f;r&&(g=f.filter(e=>this.categorizeTool(e)===r));let y=await t.select({count:(0,i.i6)`count(*)`}).from(a.mcpTools).where(m.length>0?(0,n.xD)(...m):void 0),T=Number(y[0]?.count??0);return{tools:g,totalCount:T,hasMore:d+g.length<T}}async getTool(e){let t=this.cache.get(e);if(t&&Date.now()-this.cacheTimestamp<this.CACHE_TTL)return t;let o=(0,s.V)(),i=l(await o.query.mcpTools.findFirst({where:(0,n.eq)(a.mcpTools.id,e),with:{server:!0}}));return i&&(this.cache.set(e,i),this.cacheTimestamp=Date.now()),i}async getToolsByIds(e){if(0===e.length)return[];let t=(0,s.V)();return(await t.query.mcpTools.findMany({where:(0,i.i6)`${a.mcpTools.id} IN ${e}`,with:{server:!0}})).map(l).filter(e=>null!==e)}async getAgentTools(e){let t=(0,s.V)();return(await t.query.agentTools.findMany({where:(0,n.xD)((0,n.eq)((0,i.i6)`agent_id`,e),(0,n.eq)((0,i.i6)`is_enabled`,!0)),with:{tool:{with:{server:!0}}}})).map(e=>l(e.tool)).filter(e=>null!==e)}convertToGatewayTools(e){return e.map(e=>({type:"function",function:{name:e.name,description:e.description??`Execute ${e.name}`,parameters:e.inputSchema}}))}categorizeTool(e){let t=e.name.toLowerCase(),o=(e.description??"").toLowerCase();if(r[t])return r[t];for(let[e,s]of Object.entries(r))if(t.includes(e)||o.includes(e))return s;let s=e.server?.name.toLowerCase()??"";return s.includes("filesystem")?"filesystem":s.includes("web")||s.includes("search")?"web":s.includes("sqlite")||s.includes("database")?"database":s.includes("github")?"development":"custom"}async getCategorizedTools(){let{tools:e}=await this.getTools({isEnabled:!0,limit:1e3}),t={filesystem:[],web:[],database:[],api:[],communication:[],development:[],data:[],custom:[]};for(let o of e){let e=this.categorizeTool(o);t[e].push({tool:o,category:e,tags:this.extractTags(o),popularity:o.useCount})}for(let e of Object.keys(t))t[e].sort((e,t)=>t.popularity-e.popularity);return t}async setToolEnabled(e,t){let o=(0,s.V)();await o.update(a.mcpTools).set({isEnabled:t}).where((0,n.eq)(a.mcpTools.id,e)),this.cache.delete(e)}async recordToolUsage(e){let t=(0,s.V)();await t.update(a.mcpTools).set({useCount:(0,i.i6)`${a.mcpTools.useCount} + 1`,lastUsedAt:new Date}).where((0,n.eq)(a.mcpTools.id,e));let o=this.cache.get(e);o&&(o.useCount++,o.lastUsedAt=new Date)}async getToolCapabilities(){let{tools:e}=await this.getTools({isEnabled:!0,limit:1e3});return e.map(e=>({toolId:e.id,toolName:e.name,capabilities:this.extractCapabilities(e),inputTypes:this.extractInputTypes(e),outputTypes:this.extractOutputTypes(e)}))}async findToolsByCapability(e,t=5){let o=(await this.getToolCapabilities()).filter(t=>t.capabilities.some(t=>t.toLowerCase().includes(e.toLowerCase()))).sort((t,o)=>{let s=t.capabilities.some(t=>t.toLowerCase()===e.toLowerCase()),a=o.capabilities.some(t=>t.toLowerCase()===e.toLowerCase());return s&&!a?-1:!s&&a?1:0}).slice(0,t).map(e=>e.toolId);return this.getToolsByIds(o)}clearCache(){this.cache.clear(),this.cacheTimestamp=0}extractTags(e){let t=[],o=`${e.name} ${e.description??""}`.toLowerCase();return o.includes("read")&&t.push("read"),o.includes("write")&&t.push("write"),o.includes("search")&&t.push("search"),o.includes("create")&&t.push("create"),o.includes("delete")&&t.push("delete"),o.includes("update")&&t.push("update"),o.includes("list")&&t.push("list"),o.includes("get")&&t.push("get"),o.includes("execute")&&t.push("execute"),o.includes("run")&&t.push("run"),t}extractCapabilities(e){let t=[],o=e.name.toLowerCase(),s=(e.description??"").toLowerCase();return o.includes("file")&&t.push("file-operations"),o.includes("search")&&t.push("search"),o.includes("query")&&t.push("query"),o.includes("fetch")&&t.push("fetch"),o.includes("send")&&t.push("send"),o.includes("create")&&t.push("create"),o.includes("update")&&t.push("update"),o.includes("delete")&&t.push("delete"),s.includes("read")&&t.push("read"),s.includes("write")&&t.push("write"),[...new Set(t)]}extractInputTypes(e){let t=e.inputSchema,o=[];if(t.properties)for(let[e,s]of Object.entries(t.properties))s.type&&o.push(`${e}:${s.type}`);return o}extractOutputTypes(e){return["text","data"]}constructor(){this.cache=new Map,this.cacheTimestamp=0,this.CACHE_TTL=6e4}}let p=new c},85538:(e,t,o)=>{"use strict";o.d(t,{pw:()=>y});var s=o(26608),a=o(62197);let n=process.env.REDIS_URL??"redis://localhost:6379",i=process.env.REDIS_HOST??"localhost",r=parseInt(process.env.REDIS_PORT??"6379",10),l=process.env.REDIS_PASSWORD,c=null,p=null,u=null,d=!1;function m(){return c&&"end"!==c.status||(c=function(){let e=n&&"redis://localhost:6379"!==n?{url:n}:{options:{host:i,port:r,password:l,maxRetriesPerRequest:null,enableReadyCheck:!1}},t=e.url?new a.Redis(e.url,{maxRetriesPerRequest:null,enableReadyCheck:!1}):new a.Redis(e.options);return t.on("connect",()=>{}),t.on("ready",()=>{}),t.on("error",e=>{d||console.error("❌ Redis error:",e.message)}),t.on("close",()=>{}),t.on("reconnecting",()=>{}),t}()),c}async function h(){d=!0;let e=async(e,t)=>{if(e&&"end"!==e.status)try{await e.quit()}catch(e){console.error(`❌ Error closing Redis ${t}:`,e)}};await Promise.all([e(c,"main"),e(p,"publisher"),e(u,"subscriber")]),c=null,p=null,u=null}process.on("SIGINT",async()=>{await h(),process.exit(0)}),process.on("SIGTERM",async()=>{await h(),process.exit(0)}),process.on("beforeExit",async()=>{await h()});let f={TOOL_EXECUTION:"tool-execution",SWARM_EXECUTION:"swarm-execution",KNOWLEDGE_INDEXING:"knowledge-indexing",NOTIFICATION:"notification"},g=new s.ci(f.TOOL_EXECUTION,{connection:m(),defaultJobOptions:{attempts:3,backoff:{type:"exponential",delay:1e3},removeOnComplete:100,removeOnFail:50}});async function y(e,t){return(await g.add("execute-tool",e,{priority:5,...t})).id}new s.ci(f.SWARM_EXECUTION,{connection:m(),defaultJobOptions:{attempts:1,removeOnComplete:50,removeOnFail:20}}),new s.ci(f.KNOWLEDGE_INDEXING,{connection:m(),defaultJobOptions:{attempts:2,backoff:{type:"fixed",delay:5e3},removeOnComplete:50,removeOnFail:20}}),new s.ci(f.NOTIFICATION,{connection:m(),defaultJobOptions:{attempts:5,backoff:{type:"exponential",delay:1e3},removeOnComplete:200,removeOnFail:100}})}};